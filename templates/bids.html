{% extends 'base.html' %}

{# Set the page title for the browser tab #}
{% block title %}Bids for {{ req.title }}{% endblock %}

{% block content %}
<div class="content-block p-4"> {# Container for overall page styling #}
    <h2 class="section-title text-center mb-4">Bids for: <span class="text-primary">{{ req.title }}</span></h2>

    {% if bids %}
    <ul class="list-group list-group-flush"> {# Bootstrap list group #}
        {% for bid_item in bids %}
        <li class="list-group-item d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-3 border rounded shadow-sm">
            {# Bid Details #}
            <div class="mb-2 mb-md-0 me-md-3 flex-grow-1">
                <p class="mb-1">Price: <span class="text-success fw-bold">${{ bid_item.price }}</span></p>
                <p class="mb-1">Comment: {{ bid_item.comment }}</p>
                <p class="mb-0 text-muted">By: <span class="fw-bold">{{ bid_item.bidder.username }}</span></p>
                {# Display current bid status for poster's quick view #}
                <p class="mb-0 mt-2">Status:
                    {% if bid_item.status == 'accepted_by_poster' %}
                        <span class="badge bg-success">Accepted by You</span>
                    {% elif bid_item.status == 'confirmed_by_skilled' %}
                        <span class="badge bg-info">Confirmed by Worker</span>
                    {% elif bid_item.status == 'rejected' %}
                        <span class="badge bg-danger">Rejected by You</span>
                    {% else %}
                        <span class="badge bg-secondary">{{ bid_item.status | replace('_', ' ') | capitalize }}</span>
                    {% endif %}
                </p>
            </div>

            {# Voice Playback Section #}
            {% if bid_item.voice_file_path %}
            <div class="me-md-3 mb-2 mb-md-0">
                <button type="button" class="btn btn-sm btn-outline-info" 
                        onclick="
                            var audio = document.getElementById('bid-audio-{{ bid_item.id }}');
                            if (audio.style.display === 'none') {
                                audio.style.display = 'block';
                                audio.play();
                                this.textContent = 'Hide Voice';
                            } else {
                                audio.pause();
                                audio.currentTime = 0;
                                audio.style.display = 'none';
                                this.textContent = 'Play Bid Voice';
                            }
                            return false;
                        ">Play Bid Voice</button>
                <audio id="bid-audio-{{ bid_item.id }}" controls class="audio-player mt-2" style="display:none;"
                       src="{{ url_for('static', filename=bid_item.voice_file_path) }}" type="audio/webm">
                    Your browser does not support the audio element.
                </audio>
            </div>
            {% endif %}

            {# Action Button #}
            <div class="mt-2 mt-md-0">
                <a href="{{ url_for('main.view_bid_details', req_id=req.id, bid_id=bid_item.id) }}" class="btn btn-primary btn-sm w-100">View Details & Confirm</a>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% else %}
    <div class="alert alert-info text-center" role="alert">
        No bids yet for this requirement.
    </div>
    {% endif %}

    <div class="text-center mt-4"> {# Centered back button #}
        <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary btn-lg">Back to Dashboard</a>
    </div>
</div>
{% endblock %}